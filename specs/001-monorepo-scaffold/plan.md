# Implementation Plan: Monorepo Scaffold & Infrastructure

**Branch**: `001-monorepo-scaffold` | **Date**: 2026-02-16 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-monorepo-scaffold/spec.md`

## Summary

Set up the Turborepo monorepo skeleton with pnpm workspaces, three apps
(NestJS API, Node.js worker, static mini-app), three shared packages
(shared constants, TypeScript config, ESLint config), Docker Compose
infrastructure (PostgreSQL 16, Redis 7), multi-stage Dockerfiles, and
Turborepo pipelines (build, dev, test, lint). This establishes the
foundation for all subsequent feature development.

## Technical Context

**Language/Version**: TypeScript 5.x with `strict: true`, Node.js 22 LTS
**Primary Dependencies**: NestJS 10, @nestjs/terminus, nestjs-pino, pino,
pino-pretty, zod, Vitest, Turborepo, ESLint 9, typescript-eslint, Prettier
**Storage**: PostgreSQL 16 (provisioned, no schema yet), Redis 7 (ephemeral)
**Testing**: Vitest
**Target Platform**: Linux containers (Docker), macOS/Linux dev
**Project Type**: Turborepo monorepo (apps/ + packages/)
**Performance Goals**: API health check <1s response, startup <10s
**Constraints**: No message persistence, Redis for dedup/queue only
**Scale/Scope**: 3 apps, 3 packages, 2 infrastructure services

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. TypeScript Strict Mode & Code Quality | PASS | All packages use `strict: true` via shared tsconfig. ESLint + Prettier enforced. |
| II. Vitest Testing Standards | PASS | Vitest configured for all packages. Health check test and shared constants test included. |
| III. Observability & Logging | PASS | `nestjs-pino` for API, raw `pino` for worker. Structured JSON logging. No `console.log`. |
| IV. Performance Requirements | PASS | Health check <1s. Startup <10s. No unbounded structures in scaffold. |
| V. Technology Stack & Monorepo | PASS | Turborepo + pnpm workspaces. NestJS for API. `apps/` + `packages/` structure. `build`/`test`/`lint` scripts per package. |
| VI. Docker-First Deployment | PASS | Multi-stage Dockerfiles for api and worker. `docker-compose.yml` with Postgres + Redis. Env vars only. Health check endpoint exposed. |
| VII. Data Architecture | PASS | No message persistence. Redis ephemeral. PostgreSQL provisioned but empty (no schema in scaffold). |

**Gate result**: ALL PASS — proceed to implementation.

## Project Structure

### Documentation (this feature)

```text
specs/001-monorepo-scaffold/
├── plan.md              # This file
├── research.md          # Technology decisions
├── data-model.md        # Structural entities
├── quickstart.md        # Developer setup guide
├── contracts/
│   └── health-api.md    # Health check API contract
└── tasks.md             # Task list (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
tg-channels-forwarder/
├── apps/
│   ├── api/
│   │   ├── src/
│   │   │   ├── app.module.ts
│   │   │   ├── main.ts
│   │   │   ├── env.schema.ts
│   │   │   └── health/
│   │   │       ├── health.module.ts
│   │   │       └── health.controller.ts
│   │   ├── test/
│   │   │   └── health.spec.ts
│   │   ├── Dockerfile
│   │   ├── package.json
│   │   ├── tsconfig.json
│   │   ├── eslint.config.js
│   │   └── vitest.config.ts
│   ├── worker/
│   │   ├── src/
│   │   │   ├── main.ts
│   │   │   ├── config.ts
│   │   │   └── health.ts
│   │   ├── test/
│   │   │   └── main.spec.ts
│   │   ├── Dockerfile
│   │   ├── package.json
│   │   ├── tsconfig.json
│   │   ├── eslint.config.js
│   │   └── vitest.config.ts
│   └── mini-app/
│       ├── index.html
│       ├── Dockerfile
│       └── package.json
├── packages/
│   ├── shared/
│   │   ├── src/
│   │   │   ├── constants/
│   │   │   │   └── index.ts
│   │   │   └── index.ts
│   │   ├── test/
│   │   │   └── constants.spec.ts
│   │   ├── package.json
│   │   ├── tsconfig.json
│   │   ├── eslint.config.js
│   │   └── vitest.config.ts
│   ├── tsconfig/
│   │   ├── tsconfig.base.json
│   │   ├── tsconfig.node.json
│   │   ├── tsconfig.nestjs.json
│   │   └── package.json
│   └── eslint-config/
│       ├── index.js
│       ├── nestjs.js
│       └── package.json
├── docker-compose.yml
├── docker-compose.dev.yml
├── turbo.json
├── pnpm-workspace.yaml
├── package.json
├── .env.example
├── .gitignore
└── .prettierrc
```

**Structure Decision**: Turborepo monorepo with `apps/` for deployable
services and `packages/` for shared libraries. This directly matches
the constitution's Technology Stack & Monorepo principle (V).

## Complexity Tracking

> No constitution violations. No complexity justification needed.
